Kit_sig<- read.csv("source/Table1.Kit_sig_all_norm.csv",header = T,row.names = 1)
# significant genes
Kit_sig<- read.csv("source/Table1.Kit_sig_all_norm.csv",header = T,row.names = 1)
Kit_sig<- Kit_sig[grep("kit",colnames(Kit_sig))]
MH_sig<- read.csv("source/Table1.MH63_sig_all_norm.csv",header = T,row.names = 1)
MH_sig<-MH_sig[grep("MH",colnames(MH_sig))]
kit_res<- read.csv("source/Table1.Kit_res_all_norm.csv",header = T,row.names = 1)
MH_res<- read.csv("source/Table1.MH63_res_all_norm.csv",header = T,row.names = 1)
kit_res$LOCUS<- rownames(kit_res)
MH_res$LOCUS<- rownames(MH_res)
sig_loc<- c(rownames(Kit_sig),rownames(MH_sig)) %>% unique()
length(sig_loc)  #6643
## stats info:
idx<- c("log2FoldChange","pvalue","padj","LOCUS")
res_stat<- cbind(kit_res[sig_loc,idx],MH_res[sig_loc,idx]);dim(res_stat)
head(res_stat)
res_stat<- res_stat[,-grep("LOCUS",colnames(res_stat))]
colnames(res_stat)=c(paste0("Kit_microbiota_vs_germfree_",idx[1:3]),
paste0("MH63_microbiota_vs_germfree_",idx[1:3]))
res_stat %<>% replace(is.na (.), 0)
rownames(res_stat)<- sig_loc
# merge Kit and MH, and substitute NA with 0 (low expression genes removed in one of the cultivar)
all_sig<- cbind(kit_res[sig_loc,],MH_res[sig_loc,])
sampleN=colnames(all_sig)[c(1:6,14:17)]
all_sig_to0<- all_sig %>% replace(is.na (.), 0)
all_sig_to0<- all_sig_to0[,sampleN]
head(all_sig_to0)
head(all_sig)
#
ncbi_conversion<- read.csv("source/4_RNAseq_Kit_and_MH63_NSM/NCBI_conversion_final.txt",sep="\t",header = T)
#
ncbi_conversion<- read.csv("source/NCBI_conversion_final.txt",sep="\t",header = T)
all_sig_info<- cbind(all_sig_to0,res_stat[rownames(all_sig_to0),])
write.csv(all_sig_info,"output/Table/Fig3c_Sup.all_sig_to0_count.csv")
## k-means clustering
z_var <- apply(all_sig_to0, 1, var)
z_mean <- apply(all_sig_to0, 1, mean)
pdf("output/Figure/Fig3c_Sup.z_mean_var.pdf",width = 5,height = 5)
plot(log2(z_mean), log2(z_var), pch = '.',xlim=c(0,25),ylim=c(0,35))
abline(h = 1, col='red')
abline(v = 1, col='red')
text(x = 5,
y = 23,
labels = 'variance > 1 &\n mean > 1',
col = 'red')
dev.off()
#scaling
scaleCount<- all_sig_to0 %>% t() %>% scale() %>% t()
summary(scaleCount[1,])
dim(scaleCount)
head(scaleCount)
table(scaleCount %>% complete.cases())
########### Tips ##############
# check for complete cases, i.e. rows without missing values.
# It returns  a logical vector  indicating  whether each row is complete or not.
library(magrittr) #`%<>%`: This is the magrittr pipe assignment operator
a<- all_sig
a %<>% .[complete.cases(.),]
table(complete.cases(all_sig))
dim(a)
######
# `Elbow Method` to determine optimal clusters
# ref: https://uc-r.github.io/kmeans_clustering
library(factoextra) # clustering algorithms & visualization
set.seed(123)
pdf("output/Figure/Fig3c_Sup_Figure4.kmeans_sse.pdf",width = 5,height = 5)
fviz_nbclust(scaleCount,kmeans,method = "wss")
dev.off()
## execute
set.seed(26)
kClust10 <- kmeans(scaleCount, centers = 10, algorithm= 'MacQueen', nstart = 1000, iter.max = 20)
kClust6 <- kmeans(scaleCount, centers = 6, algorithm= 'MacQueen', nstart = 1000, iter.max = 20)
kClust5 <- kmeans(scaleCount, centers = 5, algorithm= 'MacQueen', nstart = 1000, iter.max = 20)
kClust4 <- kmeans(scaleCount, centers = 4, algorithm= 'MacQueen', nstart = 1000, iter.max = 20)
table(kClust10$cluster)
table(kClust6$cluster)
table(kClust4$cluster)
## selected genes
cl <- kClust10$cluster
prefix <- 'kmeans_10'
clusterGene <- scaleCount %>%
as.data.frame %>%
rownames_to_column(var = 'ID') %>%
as_tibble %>%
{
cl <- as.data.frame(cl) %>%
rownames_to_column(var = 'ID')
inner_join(., cl)
}
## plot core cluster
clusterCore <- clusterGene %>%
group_by(cl) %>%
summarise_at(-1, mean, na.rm = TRUE) %>% ## mean of each cluster
mutate(cl = paste0('cluster_', cl) %>%
factor(levels = paste0('cluster_', cl))) %>%
gather(Sample, NorExpress, -1) %>%
mutate(Sample = Sample )
## plot all genes
clusterGenePlot <- clusterGene %>%
gather(Sample, NorExpress, -ID, -cl) %>%
mutate(cl = paste0('cluster_', cl) %>%
factor(levels = paste0('cluster_', sort(unique(cl))))) %>%
mutate(Sample = Sample)
clusterCorePlot <- clusterCore %>% dplyr::mutate(ID = 1 : nrow(clusterCore))
ggplot(clusterGenePlot, aes(Sample, NorExpress, group = ID)) +
geom_line(color = 'grey30', alpha = 0.01) +
facet_wrap(. ~ cl, ncol = 2) +
geom_point(data = clusterCorePlot, aes(Sample, NorExpress, col = cl, group = ID)) +
geom_line(data = clusterCorePlot, aes(Sample, NorExpress, group = cl, col = cl)) +
ylab('Scaled counts') +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
guides(colour = guide_legend(title = 'kmeans (k=10)'))
ggsave(paste0("Fig3d_Sup_",prefix, '_genes.pdf'), width = 10, dpi = 320)
ggsave(paste0("output/Figure/Fig3d_Sup_",prefix, '_genes.pdf'), width = 10, dpi = 320)
write.csv(clusterCorePlot,"output/Table/Fig3d_Sup.clustercoreplot.csv")
## cluster cor pheno
##p value calculation from WGCNA
corPvalueStudent <- function(cor, nSamples) {
## ref: https://courses.lumenlearning.com/introstats1/chapter/testing-the-significance-of-the-correlation-coefficient/
T <- sqrt(nSamples - 2) * cor / sqrt(1 - cor^2)
p <- apply(T, 1:2, function(x) {
if (x < 0) {
eachp <- 1 -  pt(x, nSamples - 2, lower.tail = FALSE)
} else {
eachp <- pt(x, nSamples - 2, lower.tail = FALSE)
}
})
return(p)
}
##~~~~~~~~~~~~~~~~~~~~~~~~cluster cor phenotype~~~~~~~~~~~~~~~~~
traits <- data.frame(Cultivar = c(0,0,0,0,0,0,1,1,1,1), #MH:1
Live = c(0,0,0,1,1,1,0,0,1,1)) #Microbiota: 1
cores <- clusterGene %>%
group_by(cl) %>%
summarise_at(-1, mean, na.rm = TRUE) %>%
mutate(cl = cl %>% paste0('cluster_', .)) %>%
column_to_rownames(var = 'cl') %>%
t
moduleTraitCor <- cor(cores, traits, use = 'p')
moduleTraitPvalue <- corPvalueStudent(moduleTraitCor, nrow(traits))
traitPPlot <- moduleTraitPvalue %>%
as.data.frame %>%
rownames_to_column('cluster') %>%
gather(trait, pvalue, -1) %>%
as_tibble
traitCorPlot <- moduleTraitCor %>%
as.data.frame %>%
rownames_to_column('cluster') %>%
gather(trait, correlation, -1) %>%
as_tibble %>%
mutate(x = rep(0 : (ncol(traits) - 1), each = ncol(cores))) %>%
mutate(y = rep((ncol(cores) - 1) : 0, ncol(traits))) %>%
inner_join(traitPPlot) %>%
mutate(addtext = paste0(round(correlation, digit = 2),
'\n',
'(',
round(pvalue, digit = 2),
')'))
ggplot(traitCorPlot, aes(x = x, y = y, fill = correlation)) +
geom_tile() +
scale_fill_gradientn(colours = colorRampPalette(rev(brewer.pal(n = 7, name = 'RdYlBu')))(100),
breaks = seq(-1, 1, 0.5),
labels = format(seq(-1, 1, 0.5)),
limits = c(-1, 1)) +
geom_text(aes(label = addtext)) +
scale_x_continuous(breaks = 0 : (ncol(traits) - 1), labels = colnames(traits)) +
scale_y_continuous(breaks = 0 : (ncol(cores) - 1), labels = paste0('cluster_', (ncol(cores)):1)) +
xlab('Trait') +
ylab('Cluster')+theme_light()
ggsave(paste0("output/Figure/Fig3d_Sup.",prefix, '_trait.pdf'))
## Heatmap
scaleC <- all_sig_to0 %>%
t %>%
scale %>%
t %>%
as.data.frame %>%
rownames_to_column('ID') %>%
as_tibble %>%
rename_at(-1, .funs = list(~paste0('Scale_', .)))
rawC <- all_sig_to0 %>%
as.data.frame %>%
rownames_to_column('ID') %>%
as_tibble %>%
rename_at(-1, .funs = list(~paste0('Raw_', .)))
degresC<- res_stat
degresC$ID<- rownames(degresC)
heatPlot <- rawC %>%
inner_join(scaleC) %>%
inner_join(degresC) %>%
{
cl <- as.data.frame(cl) %>%
rownames_to_column(var = 'ID')
inner_join(., cl)
} %T>%
{(sum(names(cl) == .$ID) == nrow(.)) %>% print} %>% ## check cl names and degresC row names
dplyr::slice(cl %>% order)
deganno<- read.csv("source/Table4.res_stat2.csv",header = T,row.names = 1)
deganno$Gene<- rownames(deganno)
heatRawPlot <- heatPlot %>%
dplyr::select(ID, starts_with('Raw')) %>%
gather(sample, raw, -1) %>%
mutate(x = rep(0 : 9, each = nrow(heatPlot))) %>%
mutate(y = rep(0 : (nrow(heatPlot) - 1), 10))
heatScalePlot <- heatPlot %>%
dplyr::select(ID, starts_with('Scale')) %>%
gather(sample, scale, -1) %>%
mutate(x = rep(0 : 9, each = nrow(heatPlot))) %>%
mutate(y = rep(0 : (nrow(heatPlot) - 1), 10))
heatlog2FCPlot <- heatPlot %>%
dplyr::select(ID, ends_with('FoldChange')) %>%
gather(sample, log2FC, MH63_microbiota_vs_germfree_log2FoldChange : Kit_microbiota_vs_germfree_log2FoldChange) %>%
mutate(x = rep(0 : 1, each = nrow(heatPlot))) %>%
mutate(y = rep(0 : (nrow(heatPlot) - 1), 2))
## sig |FC| > 1 and padj < 0.05
fcsig <- heatPlot %>%
dplyr::select(ends_with('FoldChange')) %>%
transmute_all(list(~ case_when(. > 1 ~ 1,
. < -1 ~ -1,
TRUE ~ 0)))
padjsig <- heatPlot %>%
dplyr::select(ends_with('padj')) %>%
abs %>%
`<`(0.05) %>%
as_tibble %>%
transmute_all(list(~ if_else(is.na(.), FALSE, .)))
heatsigPlot <- (padjsig * fcsig) %>%
as_tibble %>%
gather(sample, sig, 1:2) %>%
mutate(x = rep(0 : 1, each = nrow(heatPlot))) %>%
mutate(y = rep(0 : (nrow(heatPlot) - 1), 2))
heatGroupPlot <- heatPlot %>%
dplyr::select(ID, cluster = cl) %>%
mutate(x = 0) %>%
mutate(y = 0 : (nrow(heatPlot) - 1))
theme_bact <- function(...) {
theme_bw() %+replace%
theme(axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks.length = unit(0, 'mm'),
axis.line = element_blank(),
panel.spacing = unit(0, 'mm'),
panel.grid = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
plot.margin = unit(c(0, 0, 0, 0), 'line'),
legend.spacing = unit(0, 'mm'),
...)
}
sampleN=colnames(all_sig)[c(1:6,14:17)]
ggplot(heatScalePlot, aes(x = x, y = y, fill = scale)) +
geom_tile() +
scale_fill_gradientn(colours = colorRampPalette(rev(brewer.pal(n = 10, name = 'Spectral')))(100), name = 'scale(count)') +
scale_x_continuous(breaks = 0 : 9,
labels = sampleN ) +
theme_bact(legend.position = 'left',
axis.text.x = element_text(angle = 90, hjust = 1))
##~~~~~~~~~~~~~~~~~~~~~~~~~~~merge all plots~~~~~~~~~~~~~~~~~~~~
groupe <- ggplot(heatGroupPlot, aes(x = x, y = y)) +
geom_tile(aes(fill = factor(cluster))) +
labs(x = NULL, y = NULL) +
scale_y_continuous(expand = c(0, 0), breaks = NULL) +
scale_x_continuous(expand = c(0, 0), breaks = NULL) +
theme_bact(title = element_blank(),
legend.position = 'none')
groupne <- heatGroupPlot %>%
group_by(cluster) %>%
summarise(y = median(y)) %>%
mutate(x = 0, cluster = cluster %>% paste0('cluster', .)) %>%
ggplot(aes(x = x, y = y, label = cluster)) +
geom_text() +
labs(x = NULL, y = NULL) +
scale_y_continuous(expand = c(0, 0),  limits = c(0, nrow(heatGroupPlot)), breaks = NULL) +
scale_x_continuous(expand = c(0, 0), breaks = NULL) +
theme_bact(title = element_blank(),
legend.position = 'none')
rawe <- ggplot(heatRawPlot, aes(x = x, y = y, fill = log2(raw))) +
geom_tile() +
scale_fill_gradientn(colours = colorRampPalette(brewer.pal(n = 7, name = 'GnBu'))(100), name = 'log2(count)') +
labs(x = NULL, y = NULL) +
scale_y_continuous(expand = c(0, 0), breaks = NULL) +
scale_x_continuous(expand = c(0, 0), breaks = NULL) +
theme_bact(title = element_blank(),
legend.position = 'none')
scalee <- ggplot(heatScalePlot, aes(x = x, y = y, fill = scale)) +
geom_tile() +
scale_fill_gradientn(colours = colorRampPalette(rev(brewer.pal(n = 10, name = 'Spectral')))(10), name = 'scale(count)') +
labs(x = NULL, y = NULL) +
scale_y_continuous(expand = c(0, 0), breaks = NULL) +
scale_x_continuous(expand = c(0, 0), breaks = NULL) +
theme_bact(title = element_blank(),
legend.position = 'none')
fce <- ggplot(heatlog2FCPlot, aes(x = x, y = y, fill = log2FC)) +
geom_tile() +
scale_fill_gradientn(colours = colorRampPalette(rev(brewer.pal(n = 8, name = 'PiYG')))(100), name = 'log2(FoldChange)') +
labs(x = NULL, y = NULL) +
scale_y_continuous(expand = c(0, 0), breaks = NULL) +
scale_x_continuous(expand = c(0, 0), breaks = NULL) +
theme_bact(title = element_blank(),
legend.position = 'none')
sige <- ggplot(heatsigPlot, aes(x = x, y = y)) +
geom_tile(aes(fill = factor(sig))) +
scale_fill_manual(name = 'Significant', labels = c('Down', 'No', 'Up'), values = c('#023C88', '#A2A2A2', '#8F0D02')) +
labs(x = NULL, y = NULL) +
scale_y_continuous(expand = c(0, 0), breaks = NULL) +
scale_x_continuous(expand = c(0, 0), breaks = NULL) +
theme_bact(title = element_blank(),
legend.position = 'none')
library(dplyr)
sigte <- heatGroupPlot %>%
select(cluster, y) %>%
inner_join(heatsigPlot) %>%
select(sample, sig, x, y, cluster) %>%
group_by(sample, cluster) %>%
dplyr::count(sig) %>%
spread(sig, n) %>%
{
loc <- heatGroupPlot %>%
group_by(cluster) %>%
summarise(y = median(y))
inner_join(., loc)
} %>%
dplyr::rename('down' = `-1`, 'no' = `0`, 'up' = `1`) %>%
ungroup %>%
mutate_at(c('down', 'no', 'up'), .funs = list(~if_else(is.na(.), 0L, .))) %>%
mutate(x = rep(c(0.2, 0.4, 0), each = max(cl))) %>%
mutate(signum = paste0(down, '/', no, '/', up)) %>%
select(signum, x, y) %>%
ggplot(aes(x = x, y = y, label = signum)) +
geom_text() +
labs(x = NULL, y = NULL) +
scale_y_continuous(expand = c(0, 0),  limits = c(0, nrow(heatGroupPlot)), breaks = NULL) +
scale_x_continuous(expand = c(0, 0), limits = c(-0.1, 0.5), breaks = NULL) +
theme_bact(title = element_blank(),
legend.position = 'none')
blanke <- ggplot(tibble(x = 0, y = 0 : (nrow(heatPlot) - 1)),
aes(x = x, y = y)) +
geom_tile(colour = 'white') +
scale_y_continuous(expand = c(0, 0), breaks = NULL) +
scale_x_continuous(expand = c(0, 0), breaks = NULL) +
theme_bact(title = element_blank(),
legend.position = 'none')
cairo_pdf(paste0("output/Figure/Fig3d_Sup.",prefix, '_heatmap_merge.pdf'), width = 15)
grid.arrange(groupne,
groupe,
blanke,
rawe,
blanke,
scalee,
blanke,
fce,
blanke,
sige,
nrow = 1,
ncol = 11,
widths = c(3.5, 1, 0.5, 13, 0.5, 13, 0.5, 3, 0.5, 3, 10) %>% {. / sum(.)})
dev.off()
g <- grid.arrange(groupne,
groupe,
blanke,
scalee,
nrow = 1,
ncol = 4,
widths = c(3.5, 1, 0.5, 13) %>% {. / sum(.)})
ggsave(file = paste0("output/Figure/Fig3d_Sup.",prefix, '_heatmap_all.pdf'), plot = g)
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~select DEGs~~~~~~~~~~~~~~~~~~~~~~~~~~~~
wholeDEG <- read_csv('source/Fig3c.Sup_kmeans_10.csv')
kmeansRes <- wholeDEG %>%
dplyr::select(ID, cl)
fcsig <- wholeDEG %>%
dplyr::select(contains('FoldChange')) %>%
transmute_all(list(~ case_when(. > log2(2) ~ 1,
. < -log2(2) ~ 1,
TRUE ~ 0)))
padjsig <- wholeDEG %>%
dplyr::select(contains('padj')) %>%
abs %>%
`<`(0.05) %>%
as_tibble %>%
transmute_all(list(~ if_else(is.na(.), FALSE, .)))
heatsig <- (padjsig * fcsig) %>%
as_tibble %>%
rowSums %>%
{. >= 1} %>%
which %>%
dplyr::slice(wholeDEG, .) %>%
inner_join(kmeansRes)
heatsig %>%
mutate_at(c('ID', 'Product'), .funs = list(~if_else(is.na(.), '', .)))
mhrld<- read.csv("source/Table3.MHdds_1_rlog.csv",row.names = 1)
kitrld<- read.csv("source/Table3.Kitdds_1_rlog.csv",row.names = 1)
## rlog transformed
rld<- cbind(mhrld[sig_loc,],kitrld[sig_loc,])
rownames(rld)<- sig_loc %>% replace(is.na(.),0)
rawC <- cbind(rld[heatsig$ID,],heatsig[,c("ID","cl")])
scaleC <- rawC[,1:10]%>%
t %>%
scale %>%
t %>%
as_tibble %>%
bind_cols(rawC %>% dplyr::select(ID, cl))
summary(as.numeric(scaleC[1,1:10]))
library(ComplexHeatmap)
cairo_pdf('output/Figure/Fig3c_kmeans_10_heatmap_sig2.pdf')
cultivar <- HeatmapAnnotation(Cultivar = c(rep("MH63",4),rep("Kitaake",6)),
col = list(Iron = c('Kitaake' = 'white', 'MH63' = 'grey')),
gp = gpar(col = 'black'))
treatment <- HeatmapAnnotation(Treatment = c(rep("Germfree",2),rep("Microbiota",2),
rep("Germfree",3),rep("Microbiota",3)),
col = list(Treatment = c('Germfree' = 'white', 'Microbiota' = 'grey')),
gp = gpar(col = 'black'))
Heatmap(matrix = scaleC[,1:10],
name = 'Scaled Counts',
row_order = order(scaleC$cl) %>% rev,
row_split = scaleC$cl,
row_gap = unit(2, "mm"),
column_order = 1:10,
column_split = c(rep("MH63",4),(rep("Kitaake",6))),
show_column_names = FALSE,
col = colorRampPalette(rev(brewer.pal(n = 10, name = 'Spectral'))[c(-3, -4, -7, -8)])(10),
top_annotation = c(cultivar, treatment))
dev.off()
write.csv(scaleC,"output/Table/Fig3c.kmeans_10_heatmap_sig2_neo.csv")
##~~~~~~~~~~~~~~~~~~~~~~~~~~box plot~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
sampleN2 <- c('kit_germfree', 'kit_microbiota',
'MH63_germfree', 'MH63_microbiota')
boxplotData<- rbind(apply(scaleC[,grep("kit_germfree",colnames(scaleC))],1,mean),
apply(scaleC[,grep("kit_microbiota",colnames(scaleC))],1,mean),
apply(scaleC[,grep("MH63_germfree",colnames(scaleC))],1,mean),
apply(scaleC[,grep("MH63_microbiota",colnames(scaleC))],1,mean)) %>%
t %>%
set_colnames(sampleN2) %>%
set_rownames(scaleC$ID)
boxplotData<- cbind(boxplotData[kmeansRes$ID,],kmeansRes)
head(boxplotData)
colors<- c(rep("#023C88",3),rep("#52B2CF",3),
rep("#527C5A",2),rep("#8E9F85",2))
color2<- c("#023C88","#52B2CF","#527C5A","#8E9F85")
for (i in 1:10) {
data1<- boxplotData %>%
dplyr::filter(cl == i) %>%
dplyr::select(-ID, -cl) %>%
gather(key = 'Conditions', value = 'ScaleCounts') %>%
mutate(Conditions = Conditions %>% factor(levels = sampleN2))
data2<- data1 %>%
group_by(Conditions) %>%
summarise_each(funs=mean) %>% ungroup()
data1 %>%
ggplot(aes(x = Conditions, y = ScaleCounts,fill=Conditions),outlier.fill=Conditions) +
geom_boxplot(lwd=.25,outlier.size=.25,width=.75) +
geom_line(data=data2,mapping=aes(x=Conditions,y=ScaleCounts,group=1), color="#C70039")+ #linetype = "dashed",
ylab(paste("Cluster",i,'Scaled counts')) +xlab("")+
theme_classic() +
theme(axis.text.x = element_blank(),
axis.text.y = element_text(size=18),
plot.title = element_text(hjust = 0.5, size = 12, face = 'bold'),
legend.text.align = 0,
axis.line = element_line(size=.25),
axis.text = element_text(size = 13),
axis.title = element_text(size = 14),
legend.text=element_text(size= 13),
legend.title = element_text(size = 14))+
scale_color_manual("black")+scale_fill_manual(values = color2)
#ggsave(paste0('../../Version2/Figure/Figure7/Figure7.kmeans_10_boxplot_cluster', i, '.pdf'),width = 15,height = 10,units = "cm")
ggsave(paste0("Fig3c_kmeans_10_boxplot_cluster", i, '.pdf'),width = 15,height =7.5,units = "cm")
}
#ggsave(paste0('../../Version2/Figure/Figure7/Figure7.kmeans_10_boxplot_cluster', i, '.pdf'),width = 15,height = 10,units = "cm")
ggsave(paste0("output/Figure/Fig3c_kmeans_10_boxplot_cluster", i, '.pdf'),width = 15,height =7.5,units = "cm")
for (i in 1:10) {
data1<- boxplotData %>%
dplyr::filter(cl == i) %>%
dplyr::select(-ID, -cl) %>%
gather(key = 'Conditions', value = 'ScaleCounts') %>%
mutate(Conditions = Conditions %>% factor(levels = sampleN2))
data2<- data1 %>%
group_by(Conditions) %>%
summarise_each(funs=mean) %>% ungroup()
data1 %>%
ggplot(aes(x = Conditions, y = ScaleCounts,fill=Conditions),outlier.fill=Conditions) +
geom_boxplot(lwd=.25,outlier.size=.25,width=.75) +
geom_line(data=data2,mapping=aes(x=Conditions,y=ScaleCounts,group=1), color="#C70039")+ #linetype = "dashed",
ylab(paste("Cluster",i,'Scaled counts')) +xlab("")+
theme_classic() +
theme(axis.text.x = element_blank(),
axis.text.y = element_text(size=18),
plot.title = element_text(hjust = 0.5, size = 12, face = 'bold'),
legend.text.align = 0,
axis.line = element_line(size=.25),
axis.text = element_text(size = 13),
axis.title = element_text(size = 14),
legend.text=element_text(size= 13),
legend.title = element_text(size = 14))+
scale_color_manual("black")+scale_fill_manual(values = color2)
#ggsave(paste0('../../Version2/Figure/Figure7/Figure7.kmeans_10_boxplot_cluster', i, '.pdf'),width = 15,height = 10,units = "cm")
ggsave(paste0("output/Figure/Fig3c_kmeans_10_boxplot_cluster", i, '.pdf'),width = 15,height =7.5,units = "cm")
}
Res<- Kit_res
table(Res$Change)
ggplot(data = Res, aes(x = log2FoldChange, y = -log10(padj), col = Change)) +
geom_vline(xintercept = c(-1, 1), col = "gray", linetype = 'dashed') +
geom_hline(yintercept = -log10(0.05), col = "gray", linetype = 'dashed') +
geom_point(size = 2,alpha=.5) +
theme_bw()+
theme(axis.text = element_text(size=15))+
scale_color_manual(values = c("#00AFBB", "grey", "#bb0c00"), # to set the colours of our variable
labels = c("Down", "NS", "Up")) + # to set the labels in case we want to overwrite the categories from the dataframe (UP, DOWN, NO)
#coord_cartesian(ylim = c(0, 60), xlim = c(-10, 10)) + # since some genes can have minuslog10padj of inf, we set these limits
labs(color = 'Severe', #legend_title,
x = expression("log"[2]*"FC"), y = expression("-log"[10]*"p-value"),
caption="Down:2540; Up: 1608; NS:20277") +
scale_x_continuous(breaks = seq(-15, 15, 5)) + # to customise the breaks in the x axis
ggtitle('Kitaake Root: Microbiota_vs_Germfree')
ggsave("output/Figure/Fig4a.Kitaake_volcano.pdf",width = 12.5,height = 10,units = "cm")
