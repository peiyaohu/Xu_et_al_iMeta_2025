rownames_to_column(var="ID")
sample_data_ps$Geno=factor(sample_data_ps$Geno, levels = c("input","Kitaake","fls2","cerk1"))
asvtab_r<- ps %>% otu_table() %>% data.frame()
beta<- vegdist(t(asvtab_r),method = "bray")
beta_df<- beta %>%
cmdscale(k=4) %>% as.data.frame()%>% rownames_to_column(var="ID")
eig<- beta %>%
cmdscale(k=4, eig=T) %>% .$eig
colnames(beta_df)<- c("ID",paste0("PC",1:4))
beta_df<- inner_join(beta_df,sample_data_ps) %>% as_tibble()
for(m in method){
#m = "shannon"
model = aov(sub_design[[m]] ~ Group, data=sub_design)
Tukey_HSD = TukeyHSD(model, ordered = TRUE, conf.level = 0.95)
Tukey_HSD_table = as.data.frame(Tukey_HSD$Group)
write.table(paste(m, "\n\t", sep=""), file=paste("Fig4_Tab_alpha_",m,".txt",sep=""),append = F, quote = F, eol = "", row.names = F, col.names = F)
suppressWarnings(write.table(Tukey_HSD_table, file=paste("Fig4_Tab_alpha_",m,".txt",sep=""), append = T, quote = F, sep="\t", eol = "\n", na = "NA", dec = ".", row.names = T, col.names = T))
# LSD test for stat label
out = LSD.test(model,"Group", p.adj="fdr") # alternative fdr
stat = out$groups
sub_design$stat=stat[as.character(sub_design$Group),]$groups
max=max(sub_design[,c(m)])
min=min(sub_design[,c(m)])
x = sub_design[,c("Group",m)]
y = x %>% group_by(Group) %>% summarise_(Max=paste('max(',m,')',sep=""))
y=as.data.frame(y)
rownames(y)=y$Group
sub_design$y=y[as.character(sub_design$Group),]$Max + (max-min)*0.1
p<-ggplot(sub_design,aes(x=Group, y=sub_design[[m]]))+
geom_boxplot(aes(fill=Group),outlier.size = .5,linewidth=.3)+
#scale_fill_manual(
#values=c("#00BFC4", "#F9766E", "#9E7C61", "darkorange"))+
geom_jitter(position=position_jitter(0.17), size=.5, alpha=0.7)+scale_y_continuous(limits = c(0,1.2*max))+
labs(title="",x="Compartment",y=m)+
geom_text(data=sub_design, aes(x=Group, y=y, color=Group, label= stat))+
theme(
legend.position="none",
axis.title.y=element_text(hjust=.5),
plot.title=element_text(size=11,hjust=.5),
)+theme_bw()+scale_fill_manual(values = color7_2)+scale_color_manual(values = color7_2)+
theme(
axis.text.x = element_text(size=12,angle = 45,hjust = 1,color="black"),
axis.text.y = element_text(size=12,color="black"),
axis.title = element_text(size = 15,color="black")
)
ggsave(paste("Fig4_", m, ".pdf", sep=""), p, width = 10, height = 9,units = "cm")
p
}
#### 3. CPCoA (Fig4e-f) #####
library(amplicon)
# set factor for sample_data
sample_data_ps<- data.frame(sample_data(ps)) %>%
rownames_to_column(var="ID")
sample_data_ps$Geno=factor(sample_data_ps$Geno, levels = c("input","Kitaake","fls2","cerk1"))
asvtab_r<- ps %>% otu_table() %>% data.frame()
beta<- vegdist(t(asvtab_r),method = "bray")
??vegdist
library(vegan)
# set factor for sample_data
sample_data_ps<- data.frame(sample_data(ps)) %>%
rownames_to_column(var="ID")
sample_data_ps$Geno=factor(sample_data_ps$Geno, levels = c("input","Kitaake","fls2","cerk1"))
asvtab_r<- ps %>% otu_table() %>% data.frame()
beta<- vegdist(t(asvtab_r),method = "bray")
beta_df<- beta %>%
cmdscale(k=4) %>% as.data.frame()%>% rownames_to_column(var="ID")
eig<- beta %>%
cmdscale(k=4, eig=T) %>% .$eig
colnames(beta_df)<- c("ID",paste0("PC",1:4))
beta_df<- inner_join(beta_df,sample_data_ps) %>% as_tibble()
beta_df$Group<- factor(beta_df$Group, levels=c("input", "Ksoil","rsoil","csoil",
"kroot","rroot","croot"))
centroid<-beta_df %>%
select(starts_with("PC"),Group) %>%
group_by(Group) %>%
summarise(PC1=mean(PC1),
PC2=mean(PC2))
# PCoA
ggplot(beta_df, aes(x=PC1, y=PC2, color=Group))+
geom_point(alpha=.7, size=2) +
labs(x=paste("PCoA 1 (", format(100 * eig[1] / sum(eig), digits=4), "%)", sep=""),
y=paste("PCoA 2 (", format(100 * eig[2] / sum(eig), digits=4), "%)", sep=""),
title=paste(m," PCoA",sep=""))+
geom_point(data=centroid,aes(fill=Group),color="black",shape=21,size=2,show.legend = F)+
scale_fill_manual(values = color7_2)+
scale_color_manual(values = color7_2)+
theme_light()+
theme(axis.title = element_text(size=15,colour = "black"),
axis.text = element_text(size=12,colour = "black"),
legend.text= element_text(size=6,colour = "black"),
legend.title = element_text(size=7),
legend.key.size = unit(.3, 'cm'),
legend.margin = margin(t=1,r=1,b=1,l=1,unit="pt"))+stat_ellipse(show.legend = F)
# PERMANOVA
perm<-1e4
permanova_df<- data.frame(method=c(),
obj=c(),
Df=c(),
SumOfSqs=c(),
R2=c(),
F=c(),
p_value=c(),
permutations=c())
permanova_non_df<- data.frame(method=c(),
obj=c(),
Df=c(),
SumOfSqs=c(),
R2=c(),
F=c(),
p_value=c(),
permutations=c())
main_theme =   theme(axis.line.x=element_line(size=.5, colour="black"),
axis.line.y=element_line(size=.5, colour="black"),
axis.ticks=element_line(color="black"),
axis.text=element_text(color="black", size=12))
permanova_non<- adonis2(beta~beta_df$Compartment+beta_df$Geno,permutations = perm)
stats_df_non<- data.frame(method=rep(m,4),
obj=c("Compartment","Geno","Residual","Total"),
Df=permanova_non$Df,
SumOfSqs=permanova_non$SumOfSqs,
R2=permanova_non$R2,
p_value=permanova_non$`Pr(>F)`,
permutations=rep(perm,4))
permanova_non_df<- rbind(permanova_non_df,stats_df_non)
permanova<- adonis2(beta~beta_df$Compartment*beta_df$Geno,permutations = perm)
stats_df<- data.frame(method=rep(m,5),
obj=c("Compartment","Geno","Interaction","Residual","Total"),
Df=permanova$Df,
SumOfSqs=permanova$SumOfSqs,
R2=permanova$R2,
F=permanova$F,
p_value=permanova$`Pr(>F)`,
permutations=rep(perm,5))
permanova_df<- rbind(permanova_df,stats_df)
# Compartment dispersions
comparison_groups<- list(c("Ksoil","rsoil","csoil"),
c("kroot","rroot","croot"))
names(comparison_groups)<- c("soil","root")
for(i in 1:2){
sub_sample<- sample_data_ps %>%
filter(Group %in% comparison_groups[[i]])
sub_beta<- beta %>% as.matrix() %>%
.[sub_sample$ID,sub_sample$ID] %>%
as.dist()
sub_sample$Geno<- factor(sub_sample$Geno,levels = c("Kitaake","fls2","cerk1"))
sub_tab<- asvtab_r[,sub_sample$ID]
rownames(sub_sample)<- sub_sample$ID
if(m!="aitchison"){
p<-beta_cpcoa(sub_tab,sub_sample,dis=m,groupID = "Geno",ellipse = T,label=F)+
scale_color_manual(values = c("#18739a","#414141","#f7d16c"))+main_theme
p
ggsave(paste0("Fig4e_to_f.CPCoA_",names(comparison_groups)[i],"_",m,".pdf"),width = 4,height = 3)
}
}
for(m in method){
#m = "shannon"
model = aov(sub_design[[m]] ~ Group, data=sub_design)
Tukey_HSD = TukeyHSD(model, ordered = TRUE, conf.level = 0.95)
Tukey_HSD_table = as.data.frame(Tukey_HSD$Group)
write.table(paste(m, "\n\t", sep=""), file=paste("Fig4_Tab_alpha_",m,".txt",sep=""),append = F, quote = F, eol = "", row.names = F, col.names = F)
suppressWarnings(write.table(Tukey_HSD_table, file=paste("Fig4_Tab_alpha_",m,".txt",sep=""), append = T, quote = F, sep="\t", eol = "\n", na = "NA", dec = ".", row.names = T, col.names = T))
# LSD test for stat label
out = LSD.test(model,"Group", p.adj="fdr") # alternative fdr
stat = out$groups
sub_design$stat=stat[as.character(sub_design$Group),]$groups
max=max(sub_design[,c(m)])
min=min(sub_design[,c(m)])
x = sub_design[,c("Group",m)]
y = x %>% group_by(Group) %>% summarise_(Max=paste('max(',m,')',sep=""))
y=as.data.frame(y)
rownames(y)=y$Group
sub_design$y=y[as.character(sub_design$Group),]$Max + (max-min)*0.1
p<-ggplot(sub_design,aes(x=Group, y=sub_design[[m]]))+
geom_boxplot(aes(fill=Group),outlier.size = .5,linewidth=.3)+
#scale_fill_manual(
#values=c("#00BFC4", "#F9766E", "#9E7C61", "darkorange"))+
geom_jitter(position=position_jitter(0.17), size=.5, alpha=0.7)+scale_y_continuous(limits = c(0,1.2*max))+
labs(title="",x="Compartment",y=m)+
geom_text(data=sub_design, aes(x=Group, y=y, color=Group, label= stat))+
theme(
legend.position="none",
axis.title.y=element_text(hjust=.5),
plot.title=element_text(size=11,hjust=.5),
)+theme_bw()+scale_fill_manual(values = color7_2)+scale_color_manual(values = color7_2)+
theme(
axis.text.x = element_text(size=12,angle = 45,hjust = 1,color="black"),
axis.text.y = element_text(size=12,color="black"),
axis.title = element_text(size = 15,color="black")
)
ggsave(paste("output/Figure/Fig5_", m, ".pdf", sep=""), p, width = 10, height = 9,units = "cm")
p
}
# PCoA
ggplot(beta_df, aes(x=PC1, y=PC2, color=Group))+
geom_point(alpha=.7, size=2) +
labs(x=paste("PCoA 1 (", format(100 * eig[1] / sum(eig), digits=4), "%)", sep=""),
y=paste("PCoA 2 (", format(100 * eig[2] / sum(eig), digits=4), "%)", sep=""),
title=paste(m," PCoA",sep=""))+
geom_point(data=centroid,aes(fill=Group),color="black",shape=21,size=2,show.legend = F)+
scale_fill_manual(values = color7_2)+
scale_color_manual(values = color7_2)+
theme_light()+
theme(axis.title = element_text(size=15,colour = "black"),
axis.text = element_text(size=12,colour = "black"),
legend.text= element_text(size=6,colour = "black"),
legend.title = element_text(size=7),
legend.key.size = unit(.3, 'cm'),
legend.margin = margin(t=1,r=1,b=1,l=1,unit="pt"))+stat_ellipse(show.legend = F)
# PERMANOVA
perm<-1e4
permanova_df<- data.frame(method=c(),
obj=c(),
Df=c(),
SumOfSqs=c(),
R2=c(),
F=c(),
p_value=c(),
permutations=c())
permanova_non_df<- data.frame(method=c(),
obj=c(),
Df=c(),
SumOfSqs=c(),
R2=c(),
F=c(),
p_value=c(),
permutations=c())
main_theme =   theme(axis.line.x=element_line(size=.5, colour="black"),
axis.line.y=element_line(size=.5, colour="black"),
axis.ticks=element_line(color="black"),
axis.text=element_text(color="black", size=12))
permanova_non<- adonis2(beta~beta_df$Compartment+beta_df$Geno,permutations = perm)
stats_df_non<- data.frame(method=rep(m,4),
obj=c("Compartment","Geno","Residual","Total"),
Df=permanova_non$Df,
SumOfSqs=permanova_non$SumOfSqs,
R2=permanova_non$R2,
p_value=permanova_non$`Pr(>F)`,
permutations=rep(perm,4))
permanova_non_df<- rbind(permanova_non_df,stats_df_non)
permanova<- adonis2(beta~beta_df$Compartment*beta_df$Geno,permutations = perm)
stats_df<- data.frame(method=rep(m,5),
obj=c("Compartment","Geno","Interaction","Residual","Total"),
Df=permanova$Df,
SumOfSqs=permanova$SumOfSqs,
R2=permanova$R2,
F=permanova$F,
p_value=permanova$`Pr(>F)`,
permutations=rep(perm,5))
permanova_df<- rbind(permanova_df,stats_df)
# Compartment dispersions
comparison_groups<- list(c("Ksoil","rsoil","csoil"),
c("kroot","rroot","croot"))
names(comparison_groups)<- c("soil","root")
for(i in 1:2){
sub_sample<- sample_data_ps %>%
filter(Group %in% comparison_groups[[i]])
sub_beta<- beta %>% as.matrix() %>%
.[sub_sample$ID,sub_sample$ID] %>%
as.dist()
sub_sample$Geno<- factor(sub_sample$Geno,levels = c("Kitaake","fls2","cerk1"))
sub_tab<- asvtab_r[,sub_sample$ID]
rownames(sub_sample)<- sub_sample$ID
if(m!="aitchison"){
p<-beta_cpcoa(sub_tab,sub_sample,dis=m,groupID = "Geno",ellipse = T,label=F)+
scale_color_manual(values = c("#18739a","#414141","#f7d16c"))+main_theme
p
ggsave(paste0("Fig4e_to_f.CPCoA_",names(comparison_groups)[i],"_",m,".pdf"),width = 4,height = 3)
}
}
for(i in 1:2){
sub_sample<- sample_data_ps %>%
filter(Group %in% comparison_groups[[i]])
sub_beta<- beta %>% as.matrix() %>%
.[sub_sample$ID,sub_sample$ID] %>%
as.dist()
sub_sample$Geno<- factor(sub_sample$Geno,levels = c("Kitaake","fls2","cerk1"))
sub_tab<- asvtab_r[,sub_sample$ID]
rownames(sub_sample)<- sub_sample$ID
if(m!="aitchison"){
p<-beta_cpcoa(sub_tab,sub_sample,dis=m,groupID = "Geno",ellipse = T,label=F)+
scale_color_manual(values = c("#18739a","#414141","#f7d16c"))+main_theme
p
ggsave(paste0("Fig5e_to_f.CPCoA_",names(comparison_groups)[i],"_",m,".pdf"),width = 4,height = 3)
}
}
for(m in method){
#m = "shannon"
model = aov(sub_design[[m]] ~ Group, data=sub_design)
Tukey_HSD = TukeyHSD(model, ordered = TRUE, conf.level = 0.95)
Tukey_HSD_table = as.data.frame(Tukey_HSD$Group)
write.table(paste(m, "\n\t", sep=""), file=paste("Fig4_Tab_alpha_",m,".txt",sep=""),append = F, quote = F, eol = "", row.names = F, col.names = F)
suppressWarnings(write.table(Tukey_HSD_table, file=paste("output/Figure/Fig5_Tab_alpha_",m,".txt",sep=""), append = T, quote = F, sep="\t", eol = "\n", na = "NA", dec = ".", row.names = T, col.names = T))
# LSD test for stat label
out = LSD.test(model,"Group", p.adj="fdr") # alternative fdr
stat = out$groups
sub_design$stat=stat[as.character(sub_design$Group),]$groups
max=max(sub_design[,c(m)])
min=min(sub_design[,c(m)])
x = sub_design[,c("Group",m)]
y = x %>% group_by(Group) %>% summarise_(Max=paste('max(',m,')',sep=""))
y=as.data.frame(y)
rownames(y)=y$Group
sub_design$y=y[as.character(sub_design$Group),]$Max + (max-min)*0.1
p<-ggplot(sub_design,aes(x=Group, y=sub_design[[m]]))+
geom_boxplot(aes(fill=Group),outlier.size = .5,linewidth=.3)+
#scale_fill_manual(
#values=c("#00BFC4", "#F9766E", "#9E7C61", "darkorange"))+
geom_jitter(position=position_jitter(0.17), size=.5, alpha=0.7)+scale_y_continuous(limits = c(0,1.2*max))+
labs(title="",x="Compartment",y=m)+
geom_text(data=sub_design, aes(x=Group, y=y, color=Group, label= stat))+
theme(
legend.position="none",
axis.title.y=element_text(hjust=.5),
plot.title=element_text(size=11,hjust=.5),
)+theme_bw()+scale_fill_manual(values = color7_2)+scale_color_manual(values = color7_2)+
theme(
axis.text.x = element_text(size=12,angle = 45,hjust = 1,color="black"),
axis.text.y = element_text(size=12,color="black"),
axis.title = element_text(size = 15,color="black")
)
ggsave(paste("output/Figure/Fig5_", m, ".pdf", sep=""), p, width = 10, height = 9,units = "cm")
p
}
for(m in method){
#m = "shannon"
model = aov(sub_design[[m]] ~ Group, data=sub_design)
Tukey_HSD = TukeyHSD(model, ordered = TRUE, conf.level = 0.95)
Tukey_HSD_table = as.data.frame(Tukey_HSD$Group)
write.table(paste(m, "\n\t", sep=""), file=paste("Fig4_Tab_alpha_",m,".txt",sep=""),append = F, quote = F, eol = "", row.names = F, col.names = F)
suppressWarnings(write.table(Tukey_HSD_table, file=paste("output/Table/Fig5_Tab_alpha_",m,".txt",sep=""), append = T, quote = F, sep="\t", eol = "\n", na = "NA", dec = ".", row.names = T, col.names = T))
# LSD test for stat label
out = LSD.test(model,"Group", p.adj="fdr") # alternative fdr
stat = out$groups
sub_design$stat=stat[as.character(sub_design$Group),]$groups
max=max(sub_design[,c(m)])
min=min(sub_design[,c(m)])
x = sub_design[,c("Group",m)]
y = x %>% group_by(Group) %>% summarise_(Max=paste('max(',m,')',sep=""))
y=as.data.frame(y)
rownames(y)=y$Group
sub_design$y=y[as.character(sub_design$Group),]$Max + (max-min)*0.1
p<-ggplot(sub_design,aes(x=Group, y=sub_design[[m]]))+
geom_boxplot(aes(fill=Group),outlier.size = .5,linewidth=.3)+
#scale_fill_manual(
#values=c("#00BFC4", "#F9766E", "#9E7C61", "darkorange"))+
geom_jitter(position=position_jitter(0.17), size=.5, alpha=0.7)+scale_y_continuous(limits = c(0,1.2*max))+
labs(title="",x="Compartment",y=m)+
geom_text(data=sub_design, aes(x=Group, y=y, color=Group, label= stat))+
theme(
legend.position="none",
axis.title.y=element_text(hjust=.5),
plot.title=element_text(size=11,hjust=.5),
)+theme_bw()+scale_fill_manual(values = color7_2)+scale_color_manual(values = color7_2)+
theme(
axis.text.x = element_text(size=12,angle = 45,hjust = 1,color="black"),
axis.text.y = element_text(size=12,color="black"),
axis.title = element_text(size = 15,color="black")
)
ggsave(paste("output/Figure/Fig5_", m, ".pdf", sep=""), p, width = 10, height = 9,units = "cm")
p
}
for(m in method){
#m = "shannon"
model = aov(sub_design[[m]] ~ Group, data=sub_design)
Tukey_HSD = TukeyHSD(model, ordered = TRUE, conf.level = 0.95)
Tukey_HSD_table = as.data.frame(Tukey_HSD$Group)
write.table(paste(m, "\n\t", sep=""), file=paste("output/Table/Fig5_Tab_alpha_",m,".txt",sep=""),append = F, quote = F, eol = "", row.names = F, col.names = F)
# suppressWarnings(write.table(Tukey_HSD_table, file=paste("output/Table/Fig5_Tab_alpha_",m,".txt",sep=""), append = T, quote = F, sep="\t", eol = "\n", na = "NA", dec = ".", row.names = T, col.names = T))
# LSD test for stat label
out = LSD.test(model,"Group", p.adj="fdr") # alternative fdr
stat = out$groups
sub_design$stat=stat[as.character(sub_design$Group),]$groups
max=max(sub_design[,c(m)])
min=min(sub_design[,c(m)])
x = sub_design[,c("Group",m)]
y = x %>% group_by(Group) %>% summarise_(Max=paste('max(',m,')',sep=""))
y=as.data.frame(y)
rownames(y)=y$Group
sub_design$y=y[as.character(sub_design$Group),]$Max + (max-min)*0.1
p<-ggplot(sub_design,aes(x=Group, y=sub_design[[m]]))+
geom_boxplot(aes(fill=Group),outlier.size = .5,linewidth=.3)+
#scale_fill_manual(
#values=c("#00BFC4", "#F9766E", "#9E7C61", "darkorange"))+
geom_jitter(position=position_jitter(0.17), size=.5, alpha=0.7)+scale_y_continuous(limits = c(0,1.2*max))+
labs(title="",x="Compartment",y=m)+
geom_text(data=sub_design, aes(x=Group, y=y, color=Group, label= stat))+
theme(
legend.position="none",
axis.title.y=element_text(hjust=.5),
plot.title=element_text(size=11,hjust=.5),
)+theme_bw()+scale_fill_manual(values = color7_2)+scale_color_manual(values = color7_2)+
theme(
axis.text.x = element_text(size=12,angle = 45,hjust = 1,color="black"),
axis.text.y = element_text(size=12,color="black"),
axis.title = element_text(size = 15,color="black")
)
ggsave(paste("output/Figure/Fig5_", m, ".pdf", sep=""), p, width = 10, height = 9,units = "cm")
p
}
for(i in 1:2){
sub_sample<- sample_data_ps %>%
filter(Group %in% comparison_groups[[i]])
sub_beta<- beta %>% as.matrix() %>%
.[sub_sample$ID,sub_sample$ID] %>%
as.dist()
sub_sample$Geno<- factor(sub_sample$Geno,levels = c("Kitaake","fls2","cerk1"))
sub_tab<- asvtab_r[,sub_sample$ID]
rownames(sub_sample)<- sub_sample$ID
if(m!="aitchison"){
p<-beta_cpcoa(sub_tab,sub_sample,dis=m,groupID = "Geno",ellipse = T,label=F)+
scale_color_manual(values = c("#18739a","#414141","#f7d16c"))+main_theme
p
ggsave(paste0("Fig5e_to_f.CPCoA_",names(comparison_groups)[i],"_",m,".pdf"),width = 4,height = 3)
}
}
# Compartment dispersions
comparison_groups<- list(c("Ksoil","rsoil","csoil"),
c("kroot","rroot","croot"))
names(comparison_groups)<- c("soil","root")
for(i in 1:2){
sub_sample<- sample_data_ps %>%
filter(Group %in% comparison_groups[[i]])
sub_beta<- beta %>% as.matrix() %>%
.[sub_sample$ID,sub_sample$ID] %>%
as.dist()
sub_sample$Geno<- factor(sub_sample$Geno,levels = c("Kitaake","fls2","cerk1"))
sub_tab<- asvtab_r[,sub_sample$ID]
rownames(sub_sample)<- sub_sample$ID
if(m!="aitchison"){
p<-beta_cpcoa(sub_tab,sub_sample,dis=m,groupID = "Geno",ellipse = T,label=F)+
scale_color_manual(values = c("#18739a","#414141","#f7d16c"))+main_theme
p
ggsave(paste0("Fig5e_to_f.CPCoA_",names(comparison_groups)[i],"_",m,".pdf"),width = 4,height = 3)
}
}
i=1
sub_sample<- sample_data_ps %>%
filter(Group %in% comparison_groups[[i]])
sub_beta<- beta %>% as.matrix() %>%
.[sub_sample$ID,sub_sample$ID] %>%
as.dist()
sub_sample$Geno<- factor(sub_sample$Geno,levels = c("Kitaake","fls2","cerk1"))
sub_tab<- asvtab_r[,sub_sample$ID]
rownames(sub_sample)<- sub_sample$ID
if(m!="aitchison"){
p<-beta_cpcoa(sub_tab,sub_sample,dis=m,groupID = "Geno",ellipse = T,label=F)+
scale_color_manual(values = c("#18739a","#414141","#f7d16c"))+main_theme
p
ggsave(paste0("Fig5e_to_f.CPCoA_",names(comparison_groups)[i],"_",m,".pdf"),width = 4,height = 3)
}
m
??beta_cpcoa
p<-beta_cpcoa(sub_tab,sub_sample,dis="bray",groupID = "Geno",ellipse = T,label=F)+
scale_color_manual(values = c("#18739a","#414141","#f7d16c"))+main_theme
p
for(i in 1:2){
sub_sample<- sample_data_ps %>%
filter(Group %in% comparison_groups[[i]])
sub_beta<- beta %>% as.matrix() %>%
.[sub_sample$ID,sub_sample$ID] %>%
as.dist()
sub_sample$Geno<- factor(sub_sample$Geno,levels = c("Kitaake","fls2","cerk1"))
sub_tab<- asvtab_r[,sub_sample$ID]
rownames(sub_sample)<- sub_sample$ID
if(m!="aitchison"){
p<-beta_cpcoa(sub_tab,sub_sample,dis="bray",groupID = "Geno",ellipse = T,label=F)+
scale_color_manual(values = c("#18739a","#414141","#f7d16c"))+main_theme
p
ggsave(paste0("Fig5e_to_f.CPCoA_",names(comparison_groups)[i],"_",m,".pdf"),width = 4,height = 3)
}
}
ggsave(paste0("output/Figure/Fig5e_to_f.CPCoA_",names(comparison_groups)[i],"_",m,".pdf"),width = 4,height = 3)
# Compartment dispersions
comparison_groups<- list(c("Ksoil","rsoil","csoil"),
c("kroot","rroot","croot"))
names(comparison_groups)<- c("soil","root")
for(i in 1:2){
sub_sample<- sample_data_ps %>%
filter(Group %in% comparison_groups[[i]])
sub_beta<- beta %>% as.matrix() %>%
.[sub_sample$ID,sub_sample$ID] %>%
as.dist()
sub_sample$Geno<- factor(sub_sample$Geno,levels = c("Kitaake","fls2","cerk1"))
sub_tab<- asvtab_r[,sub_sample$ID]
rownames(sub_sample)<- sub_sample$ID
if(m!="aitchison"){
p<-beta_cpcoa(sub_tab,sub_sample,dis="bray",groupID = "Geno",ellipse = T,label=F)+
scale_color_manual(values = c("#18739a","#414141","#f7d16c"))+main_theme
p
ggsave(paste0("output/Figure/Fig5e_to_f.CPCoA_",names(comparison_groups)[i],"_","bray",".pdf"),width = 4,height = 3)
}
}
# Compartment dispersions
comparison_groups<- list(c("Ksoil","rsoil","csoil"),
c("kroot","rroot","croot"))
names(comparison_groups)<- c("soil","root")
for(i in 1:2){
sub_sample<- sample_data_ps %>%
filter(Group %in% comparison_groups[[i]])
sub_beta<- beta %>% as.matrix() %>%
.[sub_sample$ID,sub_sample$ID] %>%
as.dist()
sub_sample$Geno<- factor(sub_sample$Geno,levels = c("Kitaake","fls2","cerk1"))
sub_tab<- asvtab_r[,sub_sample$ID]
rownames(sub_sample)<- sub_sample$ID
if(m!="aitchison"){
p<-beta_cpcoa(sub_tab,sub_sample,dis="bray",groupID = "Geno",ellipse = T,label=F)+
scale_color_manual(values = c("#18739a","#414141","#f7d16c"))+main_theme
p
ggsave(paste0("output/Figure/Fig5e_to_f.CPCoA_",names(comparison_groups)[i],"_","bray",".pdf"),width = 4,height = 3)
}
}
